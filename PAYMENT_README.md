# USDT-TRC20 æ”¯ä»˜ç³»ç»Ÿ

å®Œæ•´çš„ USDT-TRC20 è‡ªåŠ¨æ”¯ä»˜ç³»ç»Ÿï¼Œå®ç°è‡ªåŠ¨åŒ–ä¼šå‘˜è´­ä¹°åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½

1. **æ”¯ä»˜å…¥å£**
   - åœ¨"å¼€é€š/å…‘æ¢ä¼šå‘˜"èœå•ä¸­æ–°å¢"ğŸ’ USDTå……å€¼è´­ä¹°"é€‰é¡¹
   - æä¾›å¤šä¸ªå¥—é¤é€‰æ‹©ï¼š
     - 5 USDT / 7å¤©ä¼šå‘˜
     - 15 USDT / 30å¤©ä¼šå‘˜
     - 50 USDT / 120å¤©ä¼šå‘˜
     - 100 USDT / 365å¤©ä¼šå‘˜

2. **è®¢å•åˆ›å»º**
   - ç‚¹å‡»å……å€¼é‡‘é¢åï¼Œæœºå™¨äººåˆ›å»ºè®¢å•
   - æ˜¾ç¤ºæ”¯ä»˜äºŒç»´ç  + é’±åŒ…åœ°å€ï¼ˆå¯å¤åˆ¶ï¼‰
   - é‡‘é¢å°æ•°ç‚¹å4ä½éšæœºç”Ÿæˆï¼Œé¿å…å¤šè®¢å•é‡‘é¢å†²çª
   - è®¢å•è¶…è¿‡10åˆ†é’Ÿè‡ªåŠ¨è¿‡æœŸå–æ¶ˆ
   - æ¯ç”¨æˆ·åŒæ—¶åªèƒ½æœ‰1ä¸ªå¾…æ”¯ä»˜è®¢å•

3. **åŒºå—é“¾ç›‘å¬**
   - ä½¿ç”¨ TronGrid API è½®è¯¢ç›‘å¬åŒºå—é“¾
   - å®æ—¶ç›‘å¬ USDT-TRC20 è½¬è´¦
   - æ”¶åˆ°å‡†ç¡®é‡‘é¢è‡ªåŠ¨åŒ¹é…è®¢å•

4. **å®‰å…¨éªŒè¯ï¼ˆé˜²è¯ˆéª—/é˜²å‡U/é˜²0å…ƒè´­ï¼‰**
   - æœ€å°‘ç­‰å¾… 20 æ¬¡åŒºå—ç¡®è®¤
   - éªŒè¯æ˜¯å¦ä¸ºå®˜æ–¹ USDT åˆçº¦ `TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t`
   - ç²¾ç¡®åŒ¹é…æ”¯ä»˜é‡‘é¢
   - å·²å¤„ç†äº¤æ˜“ç¼“å­˜é˜²é‡å¤å‘æ”¾
   - éªŒè¯äº¤æ˜“æ‰§è¡ŒæˆåŠŸçŠ¶æ€

5. **è‡ªåŠ¨å‘æ”¾**
   - ç¡®è®¤æ”¶æ¬¾åè‡ªåŠ¨è°ƒç”¨ `grant_membership_days()` å‘æ”¾ä¼šå‘˜
   - å‘é€ Telegram é€šçŸ¥ç»™ç”¨æˆ·å’Œç®¡ç†å‘˜

## æ–‡ä»¶ç»“æ„

```
tron.py  # ç‹¬ç«‹è¿è¡Œçš„æ”¯ä»˜ç›‘å¬æœåŠ¡ï¼ŒåŒ…å«ï¼š
â”œâ”€â”€ PaymentConfig - æ”¯ä»˜é…ç½®
â”œâ”€â”€ OrderStatus - è®¢å•çŠ¶æ€æšä¸¾  
â”œâ”€â”€ PaymentOrder - è®¢å•æ•°æ®æ¨¡å‹
â”œâ”€â”€ TransactionRecord - äº¤æ˜“è®°å½•æ¨¡å‹
â”œâ”€â”€ QRCodeGenerator - äºŒç»´ç ç”Ÿæˆå™¨
â”œâ”€â”€ PaymentDatabase - æ”¯ä»˜æ•°æ®åº“ç®¡ç†
â”œâ”€â”€ OrderManager - è®¢å•ç®¡ç†å™¨
â”œâ”€â”€ TronUSDTMonitor - åŒºå—é“¾ç›‘å¬å™¨
â”œâ”€â”€ TelegramNotifier - Telegram é€šçŸ¥å™¨
â”œâ”€â”€ TronPaymentService - ä¸»æœåŠ¡ç±»
â””â”€â”€ main() - å…¥å£å‡½æ•°

tdata.py # ä¸»æœºå™¨äººç¨‹åºï¼ˆå·²é›†æˆæ”¯ä»˜åŠŸèƒ½ï¼‰
â”œâ”€â”€ handle_vip_menu() - ä¼šå‘˜èœå•ï¼ˆæ–°å¢USDTå……å€¼æŒ‰é’®ï¼‰
â”œâ”€â”€ handle_usdt_payment() - USDTæ”¯ä»˜èœå•
â”œâ”€â”€ handle_usdt_plan_select() - å¥—é¤é€‰æ‹©å¤„ç†
â”œâ”€â”€ handle_cancel_order() - å–æ¶ˆè®¢å•
â””â”€â”€ callback handlers - å›è°ƒå¤„ç†å™¨

requirements_payment.txt # æ”¯ä»˜ç³»ç»Ÿä¾èµ–
```

## ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»ºæˆ–ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```bash
# TRONé’±åŒ…é…ç½®ï¼ˆå¿…éœ€ï¼‰
TRON_WALLET_ADDRESS=ä½ çš„TRC20æ”¶æ¬¾é’±åŒ…åœ°å€

# TronGrid API Keyï¼ˆå»ºè®®ç”³è¯·ï¼Œæé«˜è¯·æ±‚é€Ÿç‡ï¼‰
# ç”³è¯·åœ°å€: https://www.trongrid.io/
TRONGRID_API_KEY=ä½ çš„API_KEY

# Telegramé…ç½®ï¼ˆå¿…éœ€ï¼‰
TELEGRAM_BOT_TOKEN=ä½ çš„æœºå™¨äººToken

# ç®¡ç†å‘˜é€šçŸ¥ï¼ˆå¯é€‰ï¼Œæ”¶æ¬¾é€šçŸ¥å‘é€åˆ°æ­¤chat_idï¼‰
TELEGRAM_NOTIFY_CHAT_ID=ç®¡ç†å‘˜çš„Chat_ID
```

## å®‰è£…ä¾èµ–

```bash
# å®‰è£…æ”¯ä»˜ç³»ç»Ÿä¾èµ–
pip install -r requirements_payment.txt

# æˆ–æ‰‹åŠ¨å®‰è£…
pip install qrcode[pil] Pillow aiohttp base58
```

## è¿è¡Œæ–¹å¼

### æ–¹å¼1ï¼šåå°è¿è¡Œï¼ˆæ¨èï¼‰

ä½¿ç”¨ nohup åœ¨åå°è¿è¡Œæ”¯ä»˜ç›‘å¬æœåŠ¡ï¼š

```bash
nohup python tron.py > tron.log 2>&1 &
```

æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
tail -f tron.log
```

åœæ­¢æœåŠ¡ï¼š
```bash
ps aux | grep tron.py
kill <PID>
```

### æ–¹å¼2ï¼šä½¿ç”¨ screen

```bash
# åˆ›å»ºæ–°ä¼šè¯
screen -S tron

# è¿è¡ŒæœåŠ¡
python tron.py

# æ–­å¼€ä¼šè¯ï¼ˆCtrl+A+Dï¼‰

# é‡æ–°è¿æ¥
screen -r tron

# åœæ­¢æœåŠ¡ï¼ˆåœ¨screenå†…æŒ‰ Ctrl+Cï¼‰
```

### æ–¹å¼3ï¼šä½¿ç”¨ tmux

```bash
# åˆ›å»ºæ–°ä¼šè¯
tmux new -s tron

# è¿è¡ŒæœåŠ¡
python tron.py

# æ–­å¼€ä¼šè¯ï¼ˆCtrl+B+Dï¼‰

# é‡æ–°è¿æ¥
tmux attach -t tron

# åœæ­¢æœåŠ¡ï¼ˆåœ¨tmuxå†…æŒ‰ Ctrl+Cï¼‰
```

### æ–¹å¼4ï¼šä½¿ç”¨ systemdï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰

åˆ›å»ºæœåŠ¡æ–‡ä»¶ `/etc/systemd/system/tron-payment.service`ï¼š

```ini
[Unit]
Description=TRON USDT Payment Service
After=network.target

[Service]
Type=simple
User=your_user
WorkingDirectory=/path/to/tdatabot
Environment=PATH=/usr/bin:/usr/local/bin
ExecStart=/usr/bin/python3 /path/to/tdatabot/tron.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š
```bash
sudo systemctl daemon-reload
sudo systemctl start tron-payment
sudo systemctl enable tron-payment  # å¼€æœºè‡ªå¯

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status tron-payment

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u tron-payment -f
```

## æ•°æ®åº“

æ”¯ä»˜ç³»ç»Ÿä½¿ç”¨ç‹¬ç«‹çš„ SQLite æ•°æ®åº“ `payment.db`ï¼ŒåŒ…å«ä»¥ä¸‹è¡¨ï¼š

### orders è¡¨ï¼ˆè®¢å•ï¼‰
- order_id: è®¢å•IDï¼ˆä¸»é”®ï¼‰
- user_id: ç”¨æˆ·ID
- plan_id: å¥—é¤ID
- amount: æ”¯ä»˜é‡‘é¢
- status: è®¢å•çŠ¶æ€
- created_at: åˆ›å»ºæ—¶é—´
- expires_at: è¿‡æœŸæ—¶é—´
- tx_hash: äº¤æ˜“å“ˆå¸Œ
- paid_at: æ”¯ä»˜æ—¶é—´
- completed_at: å®Œæˆæ—¶é—´

### transactions è¡¨ï¼ˆäº¤æ˜“è®°å½•ï¼‰
- tx_hash: äº¤æ˜“å“ˆå¸Œï¼ˆä¸»é”®ï¼‰
- from_address: å‘é€åœ°å€
- to_address: æ¥æ”¶åœ°å€
- amount: é‡‘é¢
- timestamp: åŒºå—æ—¶é—´æˆ³
- block_number: åŒºå—å·
- confirmations: ç¡®è®¤æ•°
- contract_address: åˆçº¦åœ°å€
- processed: æ˜¯å¦å·²å¤„ç†
- order_id: å…³è”è®¢å•ID
- created_at: è®°å½•æ—¶é—´

## å®‰å…¨æœºåˆ¶

### é˜²å‡U
- âœ… éªŒè¯åˆçº¦åœ°å€ä¸ºå®˜æ–¹USDTåˆçº¦ï¼ˆTR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6tï¼‰
- âœ… æ£€æŸ¥äº¤æ˜“æ˜¯å¦çœŸå®ä¸Šé“¾

### é˜²0å…ƒè´­
- âœ… ç²¾ç¡®åŒ¹é…æ”¯ä»˜é‡‘é¢ï¼ˆè¯¯å·®<0.0001 USDTï¼‰
- âœ… é‡‘é¢éšæœºå°æ•°é¿å…å†²çª

### é˜²é‡å¤å‘æ”¾
- âœ… äº¤æ˜“å“ˆå¸Œè®°å½•ï¼Œå·²å¤„ç†äº¤æ˜“ä¸é‡å¤å¤„ç†
- âœ… è®¢å•çŠ¶æ€ç®¡ç†ï¼ˆpending/paid/completed/expired/cancelledï¼‰

### é˜²è¯ˆéª—
- âœ… è‡³å°‘20æ¬¡åŒºå—ç¡®è®¤æ‰å¤„ç†
- âœ… éªŒè¯è½¬å…¥åœ°å€æ˜¯å¦ä¸ºé…ç½®çš„æ”¶æ¬¾åœ°å€
- âœ… è®¢å•10åˆ†é’Ÿè‡ªåŠ¨è¿‡æœŸ

## ä½¿ç”¨æµç¨‹

### ç”¨æˆ·ç«¯
1. ç‚¹å‡»"å¼€é€š/å…‘æ¢ä¼šå‘˜" â†’ "ğŸ’ USDTå……å€¼è´­ä¹°"
2. é€‰æ‹©å¥—é¤ï¼ˆ7å¤©/30å¤©/120å¤©/365å¤©ï¼‰
3. è·å¾—è®¢å•ä¿¡æ¯å’ŒäºŒç»´ç 
4. ä½¿ç”¨TRC20é’±åŒ…æ‰«ç æˆ–å¤åˆ¶åœ°å€è½¬è´¦
5. è½¬è´¦ç²¾ç¡®é‡‘é¢ï¼ˆå«å°æ•°ï¼‰
6. ç­‰å¾…çº¦1åˆ†é’Ÿï¼ˆ20ä¸ªåŒºå—ç¡®è®¤ï¼‰
7. è‡ªåŠ¨åˆ°è´¦ï¼Œæ”¶åˆ°é€šçŸ¥

### ç®¡ç†å‘˜
1. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆé’±åŒ…åœ°å€ã€Bot Tokenç­‰ï¼‰
2. å¯åŠ¨æ”¯ä»˜ç›‘å¬æœåŠ¡ `python tron.py`
3. æœåŠ¡è‡ªåŠ¨ç›‘å¬åŒºå—é“¾ï¼ŒåŒ¹é…è®¢å•
4. æ”¶åˆ°æ”¯ä»˜æ—¶å‘é€ç®¡ç†å‘˜é€šçŸ¥
5. æŸ¥çœ‹æ—¥å¿—ç›‘æ§æœåŠ¡çŠ¶æ€

## æ•…éšœæ’æŸ¥

### æœåŠ¡æ— æ³•å¯åŠ¨

**é—®é¢˜**ï¼šæç¤ºé…ç½®éªŒè¯å¤±è´¥
```
âŒ é…ç½®éªŒè¯å¤±è´¥: æœªé…ç½® TRON_WALLET_ADDRESS
```

**è§£å†³**ï¼šæ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦æ­£ç¡®é…ç½®æ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡ã€‚

### è®¢å•åˆ›å»ºå¤±è´¥

**é—®é¢˜**ï¼šç‚¹å‡»å¥—é¤åæç¤º"åˆ›å»ºè®¢å•å¤±è´¥"

**å¯èƒ½åŸå› **ï¼š
1. ç”¨æˆ·å·²æœ‰å¾…æ”¯ä»˜è®¢å• â†’ å…ˆå®Œæˆæˆ–å–æ¶ˆç°æœ‰è®¢å•
2. æ•°æ®åº“æƒé™é—®é¢˜ â†’ æ£€æŸ¥ `payment.db` æ˜¯å¦å¯å†™

### æ”¯ä»˜åæœªåˆ°è´¦

**é—®é¢˜**ï¼šç”¨æˆ·æ”¯ä»˜åè¶…è¿‡5åˆ†é’Ÿä»æœªåˆ°è´¦

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥æ”¯ä»˜æœåŠ¡æ˜¯å¦è¿è¡Œï¼š`ps aux | grep tron.py`
2. æŸ¥çœ‹æœåŠ¡æ—¥å¿—ï¼š`tail -f tron.log`
3. ç¡®è®¤è½¬è´¦é‡‘é¢æ˜¯å¦ç²¾ç¡®åŒ¹é…ï¼ˆåŒ…å«å°æ•°ï¼‰
4. ç¡®è®¤ä½¿ç”¨çš„æ˜¯ USDT-TRC20ï¼ˆä¸æ˜¯TRC10æˆ–å…¶ä»–é“¾ï¼‰
5. åœ¨ TronScan æŸ¥è¯¢äº¤æ˜“æ˜¯å¦å·²ç¡®è®¤

### åŒºå—é“¾ç›‘å¬å¼‚å¸¸

**é—®é¢˜**ï¼šæ—¥å¿—æ˜¾ç¤º"TronGrid API è¯·æ±‚å¤±è´¥"

**è§£å†³**ï¼š
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç”³è¯· TronGrid API Key æé«˜è¯·æ±‚é™é¢
3. é…ç½® `TRONGRID_API_KEY` ç¯å¢ƒå˜é‡

## æ€§èƒ½ä¼˜åŒ–

### è½®è¯¢é—´éš”
é»˜è®¤10ç§’è½®è¯¢ä¸€æ¬¡ï¼Œå¯ä¿®æ”¹ `PaymentConfig.POLL_INTERVAL_SECONDS`

```python
# é«˜æ€§èƒ½æœåŠ¡å™¨å¯å‡å°‘é—´éš”
POLL_INTERVAL_SECONDS = 5  # 5ç§’

# ä½æ€§èƒ½æˆ–å…è´¹APIå¯å¢åŠ é—´éš”
POLL_INTERVAL_SECONDS = 30  # 30ç§’
```

### ç¡®è®¤æ•°è°ƒæ•´
é»˜è®¤éœ€è¦20ä¸ªåŒºå—ç¡®è®¤ï¼Œå¯æ ¹æ®é£é™©åå¥½è°ƒæ•´ï¼š

```python
# å¿«é€Ÿåˆ°è´¦ï¼ˆé£é™©è¾ƒé«˜ï¼‰
MIN_CONFIRMATIONS = 10

# æå®‰å…¨ï¼ˆåˆ°è´¦è¾ƒæ…¢ï¼‰
MIN_CONFIRMATIONS = 50
```

## ç›‘æ§å’Œç»´æŠ¤

### æ—¥å¿—ç›‘æ§
```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f tron.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep "âŒ" tron.log

# æŸ¥çœ‹æˆåŠŸæ”¯ä»˜
grep "âœ…" tron.log | grep "äº¤æ˜“åŒ¹é…æˆåŠŸ"
```

### æ•°æ®åº“å¤‡ä»½
```bash
# å¤‡ä»½æ”¯ä»˜æ•°æ®åº“
cp payment.db payment.db.backup.$(date +%Y%m%d_%H%M%S)

# å®šæœŸå¤‡ä»½ï¼ˆæ·»åŠ åˆ° crontabï¼‰
0 2 * * * cp /path/to/payment.db /path/to/backup/payment.db.backup.$(date +\%Y\%m\%d)
```

### å¥åº·æ£€æŸ¥
```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
ps aux | grep tron.py

# æ£€æŸ¥æœ€åå¤„ç†æ—¶é—´ï¼ˆæŸ¥çœ‹æ—¥å¿—ï¼‰
tail -n 100 tron.log | grep "ç›‘å¬å¾ªç¯"
```

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°å¥—é¤
ç¼–è¾‘ `tron.py` ä¸­çš„ `PaymentConfig.PAYMENT_PLANS`ï¼š

```python
PAYMENT_PLANS = {
    "plan_7d": {"days": 7, "price": 5.0, "name": "7å¤©ä¼šå‘˜"},
    # æ·»åŠ æ–°å¥—é¤
    "plan_90d": {"days": 90, "price": 30.0, "name": "90å¤©ä¼šå‘˜"},
}
```

åœ¨ `tdata.py` çš„ `handle_usdt_payment()` ä¸­æ·»åŠ æŒ‰é’®ï¼š

```python
[InlineKeyboardButton("90å¤©ä¼šå‘˜ - 30 USDT", callback_data="usdt_plan_90d")],
```

### æ”¯æŒå…¶ä»–ä»£å¸
å¯ä¿®æ”¹ç›‘å¬å™¨æ”¯æŒå…¶ä»–TRC20ä»£å¸ï¼Œåªéœ€æ›´æ”¹ï¼š
1. `PaymentConfig.USDT_CONTRACT` - ä»£å¸åˆçº¦åœ°å€
2. é‡‘é¢è½¬æ¢é€»è¾‘ï¼ˆæ ¹æ®ä»£å¸ç²¾åº¦ï¼‰

### Webhookæ¨¡å¼
ç›®å‰ä½¿ç”¨è½®è¯¢æ¨¡å¼ï¼Œå¯æ”¹é€ ä¸ºWebhookæ¨¡å¼ä»¥æé«˜æ•ˆç‡ï¼š
1. ä½¿ç”¨ TronGrid Webhook API
2. æ¥æ”¶å®æ—¶æ¨é€é€šçŸ¥
3. å‡å°‘APIè¯·æ±‚æ¬¡æ•°

## å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆè¦ç”¨éšæœºå°æ•°ï¼Ÿ**
A: é¿å…å¤šä¸ªè®¢å•é‡‘é¢ç›¸åŒå¯¼è‡´åŒ¹é…é”™è¯¯ã€‚ä¾‹å¦‚ä¸¤ä¸ªç”¨æˆ·åŒæ—¶è´­ä¹°5Uå¥—é¤ï¼Œç”Ÿæˆ5.1234å’Œ5.5678ä¸¤ä¸ªä¸åŒé‡‘é¢ã€‚

**Q: å¯ä»¥æ”¯æŒå…¶ä»–é“¾å—ï¼Ÿ**
A: ä»£ç æ¡†æ¶æ”¯æŒï¼Œä½†éœ€è¦ä¿®æ”¹åŒºå—é“¾ç›‘å¬å™¨éƒ¨åˆ†ã€‚æ¨èTRONå› ä¸ºè½¬è´¦è´¹ç”¨ä½ï¼ˆçº¦0.1 TRXï¼‰ã€‚

**Q: è®¢å•è¿‡æœŸåå¯ä»¥ç»§ç»­æ”¯ä»˜å—ï¼Ÿ**
A: ä¸å¯ä»¥ã€‚è¿‡æœŸè®¢å•ä¼šè‡ªåŠ¨å–æ¶ˆï¼Œéœ€è¦é‡æ–°åˆ›å»ºè®¢å•ã€‚

**Q: æ”¯æŒé€€æ¬¾å—ï¼Ÿ**
A: è‡ªåŠ¨ç³»ç»Ÿä¸æ”¯æŒé€€æ¬¾ã€‚å¦‚éœ€é€€æ¬¾è¯·è”ç³»ç®¡ç†å‘˜äººå·¥å¤„ç†ã€‚

**Q: ä¸ºä»€ä¹ˆè¦20ä¸ªåŒºå—ç¡®è®¤ï¼Ÿ**
A: é˜²æ­¢åŒèŠ±æ”»å‡»å’Œäº¤æ˜“å›æ»šã€‚TRONå‡ºå—çº¦3ç§’ï¼Œ20ä¸ªåŒºå—çº¦1åˆ†é’Ÿã€‚

## æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿ
1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ `tron.log`
2. æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
3. ç¡®è®¤ä¾èµ–å·²æ­£ç¡®å®‰è£…
4. æŸ¥çœ‹ GitHub Issues

## è®¸å¯è¯

ä¸ä¸»é¡¹ç›®ä¿æŒä¸€è‡´ã€‚
